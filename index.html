<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <?!= include('style'); ?>        

</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-wallet me-2"></i><b>บันทึกรายรับ-รายจ่าย</b></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="fas fa-chart-pie me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('transactions')">
                            <i class="fas fa-plus-circle me-1"></i>บันทึกรายการ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('accounts')">
                            <i class="fas fa-landmark me-1"></i>บัญชี
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('categories')">
                            <i class="fas fa-tags me-1"></i>จัดการหมวดหมู่
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('budget')">
                            <i class="fas fa-calculator me-1"></i>ตั้งงบประมาณ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('tax')">
                            <i class="fas fa-file-invoice-dollar me-1"></i>ภาษี
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('settings')">
                            <i class="fas fa-cog me-1"></i>การตั้งค่า
                        </a>
                    </li>
                     <li class="nav-item ms-lg-2">
                        <button class="btn btn-outline-secondary" id="theme-switcher">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h4 class="text-white">กำลังโหลดข้อมูล...</h4>
            <p class="text-white-50" id="loadingStatus">กำลังเชื่อมต่อกับ Google Sheets</p>
        </div>
    </div>
    
    <div id="pinOverlay" class="pin-overlay">
        <div class="pin-container">
            <i class="fas fa-lock fa-2x text-primary mb-3"></i>
            <h4>กรุณากรอก PIN</h4>
            <div id="pin-input-group" class="pin-input-group">
                <input type="password" class="pin-input" maxlength="1">
                <input type="password" class="pin-input" maxlength="1">
                <input type="password" class="pin-input" maxlength="1">
                <input type="password" class="pin-input" maxlength="1">
            </div>
            <p id="pinErrorMessage" class="text-danger" style="display: none;">PIN ไม่ถูกต้อง</p>
            <button id="forgotPinButton" class="btn btn-link">ลืม PIN?</button>
        </div>
    </div>

    <div class="container main-content loading">
        <div id="dashboard" class="section active">
            <div class="d-flex justify-content-between align-items-center mb-4 mt-4">
                <div>
                    <h4 class="mb-0 fw-bold"><i class="fas fa-chart-line me-2 text-primary"></i>ภาพรวม Dashboard</h4>
                </div>
                <div class="d-flex align-items-center">
                    <label class="form-label me-2 mb-0">เลือกเดือน:</label>
                    <select class="form-select" id="dashboardMonth" style="width: auto;" onchange="updateDashboard()"></select>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-12">
                     <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0 fw-bold">บัญชีทั้งหมด</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#accountModal"><i class="fas fa-plus"></i> เพิ่มบัญชี</button>
                            <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#transferModal"><i class="fas fa-exchange-alt"></i> โอนเงิน</button>
                        </div>
                    </div>
                    <div id="dashboardAccountList" class="row">
                        </div>
                </div>
            </div>
            
            <div class="row mb-4">
                </div>
            <div class="row">
                </div>
        </div>

        <div id="transactions" class="section">
             <div class="d-flex justify-content-between align-items-center mb-4 mt-4">
                <h4 class="mb-0 fw-bold"><i class="fas fa-history me-2 text-primary"></i>ประวัติรายการ</h4>
            </div>
            <div class="card mt-4">
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-striped" id="historyTable">
                          </table>
                  </div>
              </div>
          </div>
        </div>
        
        <div id="categories" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4 mt-4">
                <h4 class="mb-0 fw-bold"><i class="fas fa-tags me-2 text-primary"></i>จัดการหมวดหมู่</h4>
                 <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#categoryModal">
                    <i class="fas fa-plus me-1"></i>เพิ่มหมวดหมู่ใหม่
                </button>
            </div>
            <div class="row">
                <div class="col-lg-6">
                  <div class="card">
                      <div class="card-header"><h5 class="mb-0">รายรับ</h5></div>
                      <div class="card-body"><div id="incomeList" class="mb-3"></div></div>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="card">
                      <div class="card-header"><h5 class="mb-0">รายจ่าย</h5></div>
                      <div class="card-body"><div id="expenseList"></div></div>
                  </div>
                </div>
            </div>
        </div>

        </div>
    
    <button class="fab" data-bs-toggle="modal" data-bs-target="#transactionModal" title="เพิ่มรายการใหม่">
        <i class="fas fa-plus"></i>
    </button>

    <div class="modal fade" id="transactionModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>บันทึกรายการใหม่</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
             <form id="transactionForm">
                <div id="transactionCards">
                    </div>
                <div class="d-flex justify-content-between mt-2">
                    <button type="button" class="btn btn-success" onclick="addTransactionCard()">
                        <i class="fas fa-plus me-1"></i>เพิ่มแถว
                    </button>
                </div>
             </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="button" class="btn btn-primary" id="saveTransactionsBtn"><i class="fas fa-save me-2"></i>บันทึกทั้งหมด</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="accountModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-landmark me-2"></i>เพิ่มบัญชีใหม่</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="accountForm">
                <div class="mb-3">
                    <label class="form-label">ชื่อบัญชี</label>
                    <input type="text" class="form-control" id="accountName" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">ประเภท</label>
                    <input type="text" class="form-control" id="accountType" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">ยอดเงินเริ่มต้น</label>
                    <input type="number" class="form-control" id="initialBalance" value="0" required>
                </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="submit" form="accountForm" class="btn btn-primary"><i class="fas fa-plus me-1"></i>ยืนยัน</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="transferModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-exchange-alt me-2"></i>โอนเงินระหว่างบัญชี</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="transferForm">
                 <div class="mb-3"><label class="form-label">วันที่</label><input type="date" class="form-control" id="transferDate" required></div>
                 <div class="mb-3"><label class="form-label">จากบัญชี</label><select class="form-select" id="transferFrom" required></select></div>
                 <div class="mb-3"><label class="form-label">ไปบัญชี</label><select class="form-select" id="transferTo" required></select></div>
                 <div class="mb-3"><label class="form-label">จำนวนเงิน</label><input type="number" class="form-control" id="transferAmount" min="0.01" step="0.01" required></div>
                 <div class="mb-3"><label class="form-label">หมายเหตุ</label><input type="text" class="form-control" id="transferDescription"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
            <button type="submit" form="transferForm" class="btn btn-success"><i class="fas fa-check me-1"></i>ยืนยันการโอน</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="categoryModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-tags me-2"></i>เพิ่มหมวดหมู่ใหม่</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="submit" form="categoryForm" class="btn btn-primary"><i class="fas fa-plus me-1"></i>เพิ่มหมวดหมู่</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container"></div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <?!= include('JavaScript'); ?>    
</body>
</html>
